<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§¨‡§∞‡•ç‡§•‡§°‡•á ‡§≤‡§ø‡§∏‡•ç‡§ü - ‡§è‡§°‡§ø‡§ü ‡§Ü‡§£‡§ø ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§°‡§ø‡§≤‡•Ä‡§ü</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        :root { --primary: #ff4757; --secondary: #2f3542; --bg: #f1f2f6; --edit: #1e90ff; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 450px; margin: 20px auto; background: white; padding: 25px; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.05); }
        h2 { text-align: center; color: var(--secondary); margin-bottom: 20px; }
        .input-group { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        input { width: 100%; padding: 15px; border-radius: 12px; border: 2px solid #f1f1f1; box-sizing: border-box; font-size: 16px; outline: none; }
        input:focus { border-color: var(--primary); }
        .btn-group { display: flex; gap: 10px; }
        button { flex: 1; padding: 14px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-add { background: var(--primary); color: white; }
        .btn-pdf { background: var(--secondary); color: white; }
        .stats-card { background: var(--primary); color: white; padding: 12px; border-radius: 12px; text-align: center; font-weight: bold; margin-bottom: 15px; }
        
        table { width: 100%; border-collapse: collapse; }
        td { padding: 12px 5px; border-bottom: 1px solid #f1f1f1; color: var(--secondary); }
        .actions { display: flex; gap: 8px; justify-content: flex-end; }
        .edit-btn { color: var(--edit); cursor: pointer; font-size: 13px; font-weight: bold; border: 1px solid var(--edit); padding: 4px 8px; border-radius: 5px; }
        .delete-btn { color: #ff4757; cursor: pointer; font-size: 13px; font-weight: bold; border: 1px solid #ff4757; padding: 4px 8px; border-radius: 5px; }
        .list-wrapper { overflow: visible !important; }
        @media print { .no-print { display: none !important; } .container { box-shadow: none; width: 100%; } }
    </style>
</head>
<body>

<div class="container">
    <div class="no-print">
        <h2>‡§µ‡§æ‡§¢‡§¶‡§ø‡§µ‡§∏ ‡§Ø‡§æ‡§¶‡•Ä üéÇ</h2>
        <div class="input-group">
            <input type="text" id="guestName" placeholder="‡§™‡§æ‡§π‡•Å‡§£‡•ç‡§Ø‡§æ‡§ö‡•á ‡§®‡§æ‡§µ ‡§≤‡§ø‡§π‡§æ...">
            <div class="btn-group">
                <button class="btn-add" onclick="addGuest()">‚úÖ ‡§ú‡•ã‡§°‡§æ</button>
                <button class="btn-pdf" onclick="generatePDF()">üìÑ PDF ‡§ï‡§æ‡§¢‡§æ</button>
            </div>
        </div>
    </div>

    <div id="report-area">
        <div class="stats-card">‡§è‡§ï‡•Ç‡§£ ‡§™‡§æ‡§π‡•Å‡§£‡•á: <span id="count">0</span></div>
        <div class="list-wrapper">
            <table>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCsgwBoTiEtSNJ2xMm4di0F0GiAtFxoswM",
        authDomain: "order-b15a8.firebaseapp.com",
        projectId: "order-b15a8",
        databaseURL: "https://order-b15a8-default-rtdb.firebaseio.com",
        storageBucket: "order-b15a8.firebasestorage.app",
        messagingSenderId: "614443594278",
        appId: "1:614443594278:web:e31715b6ee592b30326ce7"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const guestRef = database.ref('birthday_guests_v3');

    function addGuest() {
        const input = document.getElementById('guestName');
        const name = input.value.trim();
        if (name !== "") {
            guestRef.push({ name: name, timestamp: Date.now() });
            input.value = "";
        }
    }

    guestRef.on('value', (snapshot) => {
        const tableBody = document.getElementById('tableBody');
        const countSpan = document.getElementById('count');
        tableBody.innerHTML = "";
        let i = 0;
        snapshot.forEach((childSnapshot) => {
            i++;
            const data = childSnapshot.val();
            const key = childSnapshot.key;
            tableBody.innerHTML += `<tr>
                <td style="width:25px; color:#ccc;">${i}</td>
                <td><b>${data.name}</b></td>
                <td class="no-print actions">
                    <span class="edit-btn" onclick="editGuest('${key}', '${data.name}')">‡§è‡§°‡§ø‡§ü</span>
                    <span class="delete-btn" onclick="deleteGuest('${key}')">‡§ï‡§æ‡§¢‡§æ</span>
                </td>
            </tr>`;
        });
        countSpan.innerText = i;
    });

    // ‡§è‡§°‡§ø‡§ü ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®
    function editGuest(key, oldName) {
        const newName = prompt("‡§™‡§æ‡§π‡•Å‡§£‡•ç‡§Ø‡§æ‡§ö‡•á ‡§®‡§æ‡§µ ‡§∏‡•Å‡§ß‡§æ‡§∞‡§æ:", oldName);
        if (newName !== null && newName.trim() !== "") {
            database.ref('birthday_guests_v3/' + key).update({ name: newName.trim() });
        }
    }

    // ‡§°‡§¨‡§≤ ‡§ï‡§®‡•ç‡§´‡§∞‡•ç‡§Æ‡•á‡§∂‡§® ‡§°‡§ø‡§≤‡•Ä‡§ü
    function deleteGuest(key) {
        const firstCheck = confirm("‡§π‡•á ‡§®‡§æ‡§µ ‡§Ø‡§æ‡§¶‡•Ä‡§§‡•Ç‡§® ‡§ï‡§æ‡§¢‡§æ‡§Ø‡§ö‡•á ‡§ï‡§æ?");
        if (firstCheck) {
            const secondCheck = confirm("‡§ñ‡§æ‡§§‡•ç‡§∞‡•Ä ‡§Ü‡§π‡•á ‡§®‡§æ? ‡§®‡§æ‡§µ ‡§ï‡§æ‡§Ø‡§Æ‡§ö‡•á ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§π‡•ã‡§à‡§≤!");
            if (secondCheck) {
                database.ref('birthday_guests_v3/' + key).remove();
            }
        }
    }

    function generatePDF() {
        const element = document.getElementById('report-area');
        const opt = {
            margin: 10,
            filename: '‡§™‡§æ‡§π‡•Å‡§£‡•á_‡§Ø‡§æ‡§¶‡•Ä.pdf',
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
        html2pdf().set(opt).from(element).save();
    }
</script>

</body>
</html>
